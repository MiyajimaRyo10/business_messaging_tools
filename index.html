<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slack Clone for æ¡ç”¨X</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
        }
        /* Slackã®ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒã«åˆã‚ã›ãŸã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ©ã‚¹ */
        .slack-sidebar { background-color: #1A1D21; }
        .slack-sidebar-text { color: #D1D2D3; }
        .slack-sidebar-text-hover:hover { background-color: #272A2E; }
        .slack-sidebar-active { background-color: #1164A3; color: white; }
        .slack-main { background-color: #1F1F1F; }
        .slack-main-header { border-bottom: 1px solid #2D2E30; }
        .slack-message-input { background-color: #2A2D31; border: 1px solid #4A4C4E; }
        .slack-date-divider-line { border-top: 1px solid #3A3C3D; }
        .slack-date-divider-text { background-color: #1F1F1F; color: #D1D2D3; }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1F1F1F;
        }
        ::-webkit-scrollbar-thumb {
            background: #4A4C4E;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #5A5C5E;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <!-- Login Screen -->
    <div id="login-screen" class="flex items-center justify-center h-screen">
        <div class="w-full max-w-md p-8 space-y-8 bg-gray-800 rounded-lg shadow-lg text-center">
            <div>
                <svg class="mx-auto h-12 w-auto text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
                <h1 class="mt-6 text-3xl font-bold tracking-tight text-white">æ¡ç”¨Xãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å‚åŠ ã™ã‚‹</h1>
                <p class="mt-2 text-gray-400">ã“ã‚Œã¯ãƒãƒ¼ãƒ å…¨ä½“ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å††æ»‘ã«ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚</p>
            </div>
            <div class="space-y-6">
                <div>
                    <label for="name-input" class="block text-sm font-medium leading-6 text-gray-300 text-left">ãƒãƒ¼ãƒ ã®ä»£è¡¨è€…ã®åå‰ã‚’è¨˜å…¥ã™ã‚‹</label>
                    <div class="mt-2">
                        <input id="name-input" name="name" type="text" required class="block w-full rounded-md border-0 bg-white/5 py-2 px-3 text-white shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-blue-500 sm:text-sm sm:leading-6" placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ">
                    </div>
                </div>
                <button id="join-button" class="w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
                    æ¡ç”¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å‚åŠ ã™ã‚‹
                </button>
            </div>
        </div>
    </div>

    <!-- Slack App (Initially Hidden) -->
    <div id="slack-app" class="hidden h-screen antialiased text-gray-200 relative">
        <!-- Sidebar Overlay for Mobile -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden sm:hidden"></div>
        
        <!-- Sidebar -->
        <div id="sidebar" class="slack-sidebar w-72 flex-shrink-0 flex-col overflow-y-auto absolute sm:relative inset-y-0 left-0 z-30 transform -translate-x-full sm:translate-x-0 transition-transform duration-300 ease-in-out">
            <!-- Workspace Header -->
            <div class="flex items-center justify-between h-16 px-4 border-b border-gray-700 flex-shrink-0">
                <h1 class="text-xl font-bold">æ¡ç”¨X â€“ ARG</h1>
                <button class="p-2 rounded-md hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.732 3.732z"></path></svg>
                </button>
            </div>

            <!-- Quick Access -->
            <div class="p-4 space-y-2 flex-shrink-0">
                 <div class="relative">
                    <input type="text" placeholder="ã‚¸ãƒ£ãƒ³ãƒ—ã¾ãŸã¯æ¤œç´¢..." class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-4 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <svg class="w-5 h-5 absolute top-1/2 right-3 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
            </div>

            <!-- Channels & DMs Scrollable Area -->
            <div class="flex-grow overflow-y-auto">
                <!-- Channels -->
                <div class="px-4 mt-2">
                    <div class="flex items-center mb-2">
                        <h2 class="text-sm font-semibold slack-sidebar-text tracking-wider">ãƒãƒ£ãƒ³ãƒãƒ«</h2>
                    </div>
                    <nav id="channel-list" class="space-y-1">
                        <!-- ãƒãƒ£ãƒ³ãƒãƒ«ã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                    </nav>
                </div>

                <!-- DMs -->
                 <div class="px-4 mt-4">
                    <div class="flex items-center mb-2">
                        <h2 class="text-sm font-semibold slack-sidebar-text tracking-wider">ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h2>
                    </div>
                    <nav id="dm-list" class="space-y-1">
                         <!-- DMã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                    </nav>
                </div>
            </div>

            <!-- Footer/Profile -->
            <div class="p-4 mt-auto flex-shrink-0">
                <div class="flex items-center">
                    <img src="https://placehold.co/40x40/7E3AF2/FFFFFF?text=YOU" alt="Your Avatar" class="w-8 h-8 rounded-md">
                    <span id="user-profile-name" class="ml-3 text-sm font-medium">ã‚ãªãŸ</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="main-content" class="flex-1 flex flex-col overflow-hidden slack-main">
            <!-- Header -->
            <header id="main-header" class="flex items-center justify-between h-16 px-6 slack-main-header flex-shrink-0">
                <!-- ãƒ˜ãƒƒãƒ€ãƒ¼å†…å®¹ã¯JSã§å‹•çš„ã«è¨­å®š -->
            </header>

            <!-- Messages -->
            <main id="message-container" class="flex-1 overflow-y-auto p-6">
                <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯JSã§å‹•çš„ã«ç”Ÿæˆ -->
            </main>

            <!-- Message Input -->
            <footer class="p-4 flex-shrink-0">
                <div id="message-input-container" class="flex items-center slack-message-input rounded-lg p-2">
                     <button id="add-button" class="p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-full">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                    </button>
                    <input id="message-input-field" type="text" placeholder="#channelã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸" class="flex-1 bg-transparent px-4 py-2 text-white focus:outline-none">
                    <button id="send-button" class="p-2 text-gray-400 hover:text-white hover:bg-blue-600 rounded-full">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path></svg>
                    </button>
                </div>
                 <div id="typing-indicator-container" class="h-5 text-xs text-gray-400 pl-4 pt-1"></div>
            </footer>
        </div>
    </div>

    <script>
        // --- ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ---
        let currentChannelId = 'c0'; // æ³¨æ„äº‹é …ãƒãƒ£ãƒ³ãƒãƒ«ã‚’æœ€åˆã«è¡¨ç¤º
        let currentUserName = 'ã‚ãªãŸ';
        let typingUsers = {}; // { channelId: { userId: 'userName' } }

        // --- æ—¥ä»˜å–å¾—é–¢æ•° ---
        function getTodayDateString() {
            const today = new Date();
            return `${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ${today.getDate()}æ—¥`;
        }

        // --- ãƒ‡ãƒ¼ã‚¿å®šç¾© ---
        const mockData = {
            channels: [
                { id: 'c0', name: 'ã€æ³¨æ„äº‹é …ã€‘âš ï¸å¿…ãšèª­ã‚“ã§ãã ã•ã„', isPublic: true, members: 36, hasNotification: false },
                { id: 'c1', name: '1_å…¨ä½“é€£çµ¡', isPublic: true, members: 36, hasNotification: false },
                { id: 'c2', name: '2_èª²é¡Œæå‡º', isPublic: true, members: 36, hasNotification: false },
                { id: 'c3', name: '3_é›‘è«‡', isPublic: true, members: 28, hasNotification: false },
                { id: 'c4', name: '4_é¢æ¥ç·´ç¿’', isPublic: true, members: 15, hasNotification: false },
                { id: 'c5', name: 'æ¡ç”¨ãƒãƒ¼ãƒ ', isPublic: false, members: 5, hasNotification: false },
                { id: 'c6', name: 'æœ€çµ‚é¸è€ƒ', isPublic: false, members: 8, hasNotification: false },
                { id: 'c7', name: 'å­¦ç”Ÿæ¡ç”¨å§”å“¡', isPublic: false, members: 6, hasNotification: false },
            ],
            dms: [
                { id: 'd1', name: 'æ©˜ æ¶¼ä»‹ (ç¤¾é•·)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' },
                { id: 'd2', name: 'äººäº‹éƒ¨é•·', avatar: 'https://placehold.co/40x40/E94F37/FFFFFF?text=HR' },
                { id: 'd3', name: 'æ©˜ é™½è‘µ (ãƒ¡ãƒ³ã‚¿ãƒ¼)', avatar: 'https://placehold.co/40x40/F4A261/FFFFFF?text=T' },
                { id: 'd4', name: 'å®®å¶‹ ãã‚“', avatar: 'https://placehold.co/40x40/2A9D8F/FFFFFF?text=M' },
                { id: 'd5', name: 'ä½è—¤ èŠ±å­', avatar: 'https://placehold.co/40x40/F2C53D/FFFFFF?text=S' },
                { id: 'd6', name: 'éˆ´æœ¨ ä¸€éƒ', avatar: 'https://placehold.co/40x40/4A7B9D/FFFFFF?text=S' },
            ],
            messages: {
                'c0': [
                    { type: 'date', date: getTodayDateString() },
                    { 
                        type: 'message',
                        user: { id: 'system', name: 'ã‚·ã‚¹ãƒ†ãƒ ', avatar: 'https://placehold.co/40x40/cccccc/000000?text=S' },
                        time: '08:59',
                        text: '<strong>æ³¨æ„äº‹é …</strong><br>ãƒ»ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€å†èª­ã¿è¾¼ã¿ã‚’ã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ãŒå…¨ã¦æ¶ˆãˆã¦ã—ã¾ã„ã¾ã™ã€‚å†èª­ã¿è¾¼ã¿ã—ãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚'
                    }
                ],
                'c1': [
                    { type: 'date', date: getTodayDateString() },
                    { 
                        type: 'message',
                        user: { id: 'system', name: 'ã‚·ã‚¹ãƒ†ãƒ ', avatar: 'https://placehold.co/40x40/cccccc/000000?text=S' },
                        time: '09:00',
                        text: 'ã‚ˆã†ã“ãã€Œæ¡ç”¨Xã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã€‚<br>ã¾ãšã¯ #ã€æ³¨æ„äº‹é …ã€‘âš ï¸å¿…ãšèª­ã‚“ã§ãã ã•ã„ ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å¿…ãšç¢ºèªã—ã¦ãã ã•ã„ã€‚<br>ãã®å¾Œã€#å­¦ç”Ÿæ¡ç”¨å§”å“¡ ãƒãƒ£ãƒ³ãƒãƒ«ã«ç¤¾é•·ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šãã¾ã™ã€‚'
                    },
                     { 
                        type: 'message',
                        user: { id: 'player', name: 'ã‚ãªãŸ', avatar: 'https://placehold.co/40x40/7E3AF2/FFFFFF?text=YOU' },
                        time: '09:01',
                        text: 'æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚ã¾ãšæ³¨æ„äº‹é …ã‚’ç¢ºèªã—ã¾ã™ã€‚'
                    }
                ],
                'c2': [
                    { type: 'date', date: getTodayDateString() },
                    { 
                        type: 'message',
                        user: { id: 'system', name: 'ã‚·ã‚¹ãƒ†ãƒ ', avatar: 'https://placehold.co/40x40/cccccc/000000?text=S' },
                        time: '00:01',
                        text: 'ã“ã®ãƒãƒ£ãƒ³ãƒãƒ«ã¯èª²é¡Œæå‡ºå°‚ç”¨ã§ã™ã€‚æå‡ºç‰©ä»¥å¤–ã®æŠ•ç¨¿ã¯ã”é æ…®ãã ã•ã„ã€‚'
                    }
                ],
                'c3': [
                     { type: 'date', date: '2025å¹´8æœˆ11æ—¥' }, // éå»ã®ä¼šè©±ã¨ã—ã¦æ—¥ä»˜ã‚’å›ºå®š
                    { 
                        type: 'message',
                        user: { id: 'u2', name: 'ä½è—¤ èŠ±å­', avatar: 'https://placehold.co/40x40/F2C53D/FFFFFF?text=S' },
                        time: '18:30',
                        text: 'çš†ã•ã‚“ã€ä¸€æ¬¡é¸è€ƒã©ã†ã§ã—ãŸã‹ï¼Ÿç§ã¯çµæ§‹ç·Šå¼µã—ã¾ã—ãŸâ€¦ï¼'
                    },
                    { 
                        type: 'message',
                        user: { id: 'u3', name: 'éˆ´æœ¨ ä¸€éƒ', avatar: 'https://placehold.co/40x40/4A7B9D/FFFFFF?text=S' },
                        time: '18:32',
                        text: 'ãŠç–²ã‚Œæ§˜ã§ã™ï¼ã‚ã‹ã‚Šã¾ã™ã€ç‹¬ç‰¹ã®é›°å›²æ°—ã‚ã‚Šã¾ã™ã‚ˆã­ã€‚æ¬¡ã®èª²é¡Œã‚‚é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼'
                    }
                ],
                'c7': []
            }
        };

        // --- DOMè¦ç´  ---
        const loginScreen = document.getElementById('login-screen');
        const slackApp = document.getElementById('slack-app');
        const nameInput = document.getElementById('name-input');
        const joinButton = document.getElementById('join-button');
        const userProfileName = document.getElementById('user-profile-name');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const channelList = document.getElementById('channel-list');
        const dmList = document.getElementById('dm-list');
        const mainHeader = document.getElementById('main-header');
        const messageContainer = document.getElementById('message-container');
        const messageInputField = document.getElementById('message-input-field');
        const typingIndicatorContainer = document.getElementById('typing-indicator-container');

        // --- ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•° ---

        function renderSidebar() {
            channelList.innerHTML = mockData.channels.map(channel => `
                <a href="#" data-channel-id="${channel.id}" class="channel-link flex items-center px-2 py-1.5 rounded-md text-sm font-medium slack-sidebar-text slack-sidebar-text-hover ${channel.id === currentChannelId ? 'slack-sidebar-active' : ''}">
                    ${channel.isPublic 
                        ? '<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path></svg>' 
                        : '<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>'
                    }
                    <span class="${channel.hasNotification ? 'font-bold text-white' : ''}">${channel.name}</span>
                    ${channel.hasNotification ? '<span class="ml-auto w-2 h-2 bg-red-500 rounded-full"></span>' : ''}
                </a>
            `).join('');

            dmList.innerHTML = mockData.dms.map(dm => `
                <a href="#" class="flex items-center px-2 py-1.5 rounded-md text-sm font-medium slack-sidebar-text slack-sidebar-text-hover">
                    <img src="${dm.avatar}" alt="${dm.name}" class="w-5 h-5 rounded-sm mr-2">
                    <span>${dm.name}</span>
                </a>
            `).join('');
            
            userProfileName.textContent = currentUserName;
        }

        function renderMainContent() {
            const channel = mockData.channels.find(c => c.id === currentChannelId);
            if (!channel) return;

            mainHeader.innerHTML = `
                <div class="flex items-center">
                    <button id="sidebar-toggle" class="sm:hidden mr-4 p-2 rounded-md hover:bg-gray-700">
                         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                    <h2 class="text-xl font-bold">${channel.isPublic ? '#' : 'ğŸ”’'} ${channel.name}</h2>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-400">${channel.members}äººã®ãƒ¡ãƒ³ãƒãƒ¼</span>
                    <button class="p-2 rounded-md hover:bg-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                    </button>
                </div>
            `;
            
            messageInputField.placeholder = `#${channel.name} ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸`;
            
            const messages = (mockData.messages[currentChannelId] && mockData.messages[currentChannelId].length > 0) 
                ? mockData.messages[currentChannelId] 
                : [{ type: 'system', text: 'ã‚ˆã†ã“ãï¼ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚' }];

            messageContainer.innerHTML = messages.map(msg => {
                if (msg.type === 'date') {
                    return `
                        <div class="relative flex justify-center my-6">
                            <div class="absolute inset-0 flex items-center" aria-hidden="true">
                                <div class="w-full slack-date-divider-line"></div>
                            </div>
                            <div class="relative flex justify-center">
                                <span class="px-3 text-sm font-medium rounded-full border border-gray-600 slack-date-divider-text">${msg.date}</span>
                            </div>
                        </div>
                    `;
                }
                if (msg.type === 'system') {
                     return `<div class="text-center text-gray-400 text-sm">${msg.text}</div>`;
                }
                
                const displayName = msg.user.id === 'player' ? currentUserName : msg.user.name;

                return `
                    <div class="flex items-start mt-4">
                        <img src="${msg.user.avatar}" alt="${displayName}" class="w-10 h-10 rounded-md mr-4">
                        <div class="flex-1">
                            <div class="flex items-baseline">
                                <span class="font-bold mr-2">${displayName}</span>
                                <span class="text-xs text-gray-500">${msg.time}</span>
                            </div>
                            <p class="text-gray-200 mt-1">${msg.text}</p>
                            ${msg.attachments ? `
                                <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2">
                                    ${msg.attachments.map(att => `
                                        <img src="${att.url}" onerror="this.onerror=null;this.src='https://placehold.co/300x200/222/FFF?text=Image+Failed';" alt="æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«" class="rounded-lg border border-gray-700">
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            messageContainer.scrollTop = messageContainer.scrollHeight;
            renderTypingIndicator();
        }

        function renderTypingIndicator() {
            const users = typingUsers[currentChannelId];
            if (users && Object.keys(users).length > 0) {
                const userNames = Object.values(users);
                let text = '';
                if (userNames.length === 1) {
                    text = `${userNames[0]}ã•ã‚“ãŒå…¥åŠ›ã—ã¦ã„ã¾ã™...`;
                } else if (userNames.length === 2) {
                    text = `${userNames.join('ã•ã‚“ã¨')}ã•ã‚“ãŒå…¥åŠ›ã—ã¦ã„ã¾ã™...`;
                } else {
                    text = 'è¤‡æ•°äººãŒå…¥åŠ›ã—ã¦ã„ã¾ã™...';
                }
                typingIndicatorContainer.textContent = text;
            } else {
                typingIndicatorContainer.textContent = '';
            }
        }
        
        // --- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ­ã‚¸ãƒƒã‚¯ ---

        function addTypingIndicator(channelId, user) {
            if (!typingUsers[channelId]) {
                typingUsers[channelId] = {};
            }
            typingUsers[channelId][user.id] = user.name;
            renderTypingIndicator();
        }

        function removeTypingIndicator(channelId, userId) {
            if (typingUsers[channelId] && typingUsers[channelId][userId]) {
                delete typingUsers[channelId][userId];
                renderTypingIndicator();
            }
        }

        function sendPresidentKickoffMessage() {
            const committeeChannel = mockData.channels.find(c => c.name === 'å­¦ç”Ÿæ¡ç”¨å§”å“¡');
            const presidentUser = { id: 'u0', name: 'æ©˜ æ¶¼ä»‹ (ç¤¾é•·)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' };
            if (!committeeChannel) return;

            if (mockData.messages[committeeChannel.id].length === 0) {
                 mockData.messages[committeeChannel.id].push({ type: 'date', date: getTodayDateString() });
            }

            const kickoffMessage = {
                type: 'message',
                user: presidentUser,
                time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
                text: `çš†ã•ã‚“ã€å‚åŠ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚<br>æ ªå¼ä¼šç¤¾EXIO DESIGNï¼ˆã‚¨ã‚¯ã‚·ã‚ªãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ä»£è¡¨ã®æ©˜ï¼ˆãŸã¡ã°ãªï¼‰ã§ã™ã€‚<br><br>ä»Šå›ã¯ã€æ–°è¦äº‹æ¥­ã€ŒAIæˆ¦ç•¥å®¤ï¼ˆã›ã‚“ã‚Šã‚ƒãã—ã¤ï¼‰ã€ã®åˆä»£UI/UXãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼æ¡ç”¨ã«ã‚ãŸã‚Šã€<br>å­¦ç”Ÿæ¡ç”¨å§”å“¡ã¨ã—ã¦ã€çš†ã•ã‚“ã«å”åŠ›ã—ã¦ã„ãŸã ãã¾ã™ã€‚<br><br>ã“ã‚Œã‹ã‚‰ã€å®®å¶‹ï¼ˆã¿ã‚„ã˜ã¾ï¼‰ãã‚“ã«å°ç­’ã‚’é…ã£ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚<br>å°ç­’ã«ã¯ã€å¿œå‹Ÿè€…ã®è³‡æ–™ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚<br><br>ã¾ãšã¯ãƒãƒ¼ãƒ ã”ã¨ã«æ¡ç”¨åŸºæº–ã‚’è©±ã—åˆã£ã¦ãã ã•ã„ã€‚<br>ã€Œç†æƒ³ã®UI/UXãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼åƒã€ã‚„ã€<br>é‡è¦–ã™ã‚‹ãƒã‚¤ãƒ³ãƒˆï¼ˆã‚¹ã‚­ãƒ«ãƒ»æˆé•·æ„æ¬²ãƒ»ç‹¬è‡ªæ€§ãƒ»å³æˆ¦åŠ› ãªã©ï¼‰ã‚’æ˜ç¢ºã«ã—ã¾ã—ã‚‡ã†ã€‚<br><br>æ¡ç”¨åŸºæº–ãŒæ±ºã¾ã£ãŸã‚‰ã€Slackã«æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚<br><br>âš ï¸ ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æ¥µç§˜æ¡ˆä»¶ã§ã™ã€‚<br>æƒ…å ±ã¯å¿…ãšã€ãƒãƒ¼ãƒ å†…ã ã‘ã§å…±æœ‰ã—ã¦ãã ã•ã„ã€‚<br><br>ãã‚Œã§ã¯ã€å„ãƒãƒ¼ãƒ ã®ä»£è¡¨è€…ã‚’æ±ºã‚ã€è©±ã—åˆã„ã‚’å§‹ã‚ã¦ãã ã•ã„ã€‚<br>æ¡ç”¨åŸºæº–ã¯Slackã«é€ã£ã¦ãã ã•ã„ã€‚<br><br>çš†ã•ã‚“ã®çš„ç¢ºãªåˆ¤æ–­ã«æœŸå¾…ã—ã¦ã„ã¾ã™ã€‚`
            };

            mockData.messages[committeeChannel.id].push(kickoffMessage);

            committeeChannel.hasNotification = true;
            renderSidebar();

            if (currentChannelId === committeeChannel.id) {
                renderMainContent();
            }
        }

        function sendPresidentURLMessage() {
            const committeeChannel = mockData.channels.find(c => c.name === 'å­¦ç”Ÿæ¡ç”¨å§”å“¡');
            const presidentUser = { id: 'u0', name: 'æ©˜ æ¶¼ä»‹ (ç¤¾é•·)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' };
            if (!committeeChannel) return;

            const urlMessage = {
                type: 'message',
                user: presidentUser,
                time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
                text: 'å›ãŸã¡ã«ã¯ã€ç‰¹åˆ¥ã«æˆ‘ãŒç¤¾ã®æ¡ç”¨ç®¡ç†ãƒ„ãƒ¼ãƒ«ãŒé–²è¦§ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸï¼ <br><a href="https://miyajimaryo10.github.io/Applicant_Tracking_System/" target="_blank" class="text-blue-400 hover:underline">EXIO DESIGNæ¡ç”¨ç®¡ç†ãƒ„ãƒ¼ãƒ«</a><br>ã“ã“ã‹ã‚‰å¿œå‹Ÿè€…ã®å±¥æ­´æ›¸ã¨ã‹ãŒè¦‹ã‚Œã¾ã™<br>ä¸€é€šã‚Šç¢ºèªã—ãŸã‚‰ã€ã€Œç¢ºèªã—ãŸã€ã£ã¦é€ã£ã¦ï¼'
            };

            mockData.messages[committeeChannel.id].push(urlMessage);

            if (currentChannelId !== committeeChannel.id) {
                committeeChannel.hasNotification = true;
            }
            
            renderSidebar();

            if (currentChannelId === committeeChannel.id) {
                renderMainContent();
            }
        }
        
        function sendPresidentFollowUpMessage() {
            const committeeChannel = mockData.channels.find(c => c.name === 'å­¦ç”Ÿæ¡ç”¨å§”å“¡');
            const presidentUser = { id: 'u0', name: 'æ©˜ æ¶¼ä»‹ (ç¤¾é•·)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' };
            if (!committeeChannel) return;

            const followUpMessage = {
                type: 'message',
                user: presidentUser,
                time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
                text: 'ç¢ºèªã‚ã‚ŠãŒã¨ã†ï¼20åˆ†ãã‚‰ã„ã§æ¡ç”¨åŸºæº–æ±ºã‚ã¦ã»ã—ã„ï¼<br>æ±ºã‚ãŸã‚‰ã€ã“ã“ã®ãƒãƒ£ãƒ³ãƒãƒ«ã«ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§é€ã£ã¦ã»ã—ã„<br>ã€Œæ¡ç”¨åŸºæº–1.ã€‡ã€‡ 2.ã€‡ã€‡ã€'
            };

            mockData.messages[committeeChannel.id].push(followUpMessage);

            if (currentChannelId !== committeeChannel.id) {
                committeeChannel.hasNotification = true;
            }
            
            renderSidebar();

            if (currentChannelId === committeeChannel.id) {
                renderMainContent();
            }
        }

        function sendPresidentSecretMessageSequence() {
            const committeeChannelId = 'c7';
            const presidentUser = { id: 'u0', name: 'æ©˜ æ¶¼ä»‹ (ç¤¾é•·)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' };
            const committeeChannel = mockData.channels.find(c => c.id === committeeChannelId);
            if (!committeeChannel) return;

            const addMessage = (text, isQR = false) => {
                const newMessage = {
                    type: 'message',
                    user: presidentUser,
                    time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
                    text: text
                };
                if (isQR) {
                    newMessage.text += `<br><img src="image/LINE_QR.png" alt="LINE QR Code" class="mt-2 rounded-lg">`;
                }
                mockData.messages[committeeChannelId].push(newMessage);
                if (currentChannelId !== committeeChannelId) {
                    committeeChannel.hasNotification = true;
                }
                renderSidebar();
                if (currentChannelId === committeeChannelId) {
                    renderMainContent();
                }
            };

            const sequence = [
                { typing: 0, message: 5000, text: "ä»Šã€æ¡ç”¨æ‹…å½“è€…ã®ä¸­ã«ã€å˜˜ã‚’ã¤ã„ã¦ã„ã‚‹äººãŒã„ã‚‹ã¨ã„ã†åŒ¿åå‘Šç™ºãŒã‚ã£ãŸ" },
                { typing: 7000, message: 12000, text: "ã“ã®è©±ã¯ãƒãƒ¼ãƒ å¤–ã«ã¯å†…ç·’ã§" },
                { typing: 14000, message: 19000, text: "Slackã¯ç¬¬ä¸‰è€…ãŒè¦‹ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚LINEã§ã‚„ã‚Šå–ã‚Šã—ã‚ˆã†" },
                { typing: 21000, message: 26000, text: "ä»¥ä¸‹ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ãƒãƒ›ã§èª­ã¿è¾¼ã‚“ã§ã€åƒ•ã®LINEã‚’è¿½åŠ ã—ã¦ã»ã—ã„ã€‚", isQR: true }
            ];

            sequence.forEach(step => {
                setTimeout(() => addTypingIndicator(committeeChannelId, presidentUser), step.typing);
                setTimeout(() => {
                    removeTypingIndicator(committeeChannelId, presidentUser.id);
                    addMessage(step.text, step.isQR);
                }, step.message);
            });
        }
        
        function handleSendMessage() {
            const text = messageInputField.value.trim();
            if (text === '') return;

            const newMessage = {
                type: 'message',
                user: { id: 'player', name: currentUserName, avatar: 'https://placehold.co/40x40/7E3AF2/FFFFFF?text=YOU' },
                time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
                text: text.replace(/\n/g, '<br>')
            };
            
            if (!mockData.messages[currentChannelId]) {
                mockData.messages[currentChannelId] = [];
            }
            mockData.messages[currentChannelId].push(newMessage);
            messageInputField.value = '';
            renderMainContent();

            // Check for conditional response
            if (currentChannelId === 'c7' && (text.includes('ç¢ºèªã—ãŸ') || text.includes('ç¢ºèªã—ã¾ã—ãŸ'))) {
                const presidentUser = { id: 'u0', name: 'æ©˜ æ¶¼ä»‹ (ç¤¾é•·)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' };
                setTimeout(() => addTypingIndicator('c7', presidentUser), 2000);
                setTimeout(() => {
                    removeTypingIndicator('c7', presidentUser.id);
                    sendPresidentFollowUpMessage();
                    
                    // 10ç§’å¾Œã«ç§˜å¯†ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’é–‹å§‹ (ãƒ†ã‚¹ãƒˆç”¨)
                    setTimeout(() => {
                        sendPresidentSecretMessageSequence();
                    }, 10000); // 10 seconds = 10,000 ms
                }, 7000);
            }
        }


        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---

        joinButton.addEventListener('click', () => {
            const enteredName = nameInput.value.trim();
            if (enteredName) {
                currentUserName = enteredName;
                loginScreen.style.display = 'none';
                slackApp.style.display = 'flex';
                renderSidebar();
                renderMainContent();
                
                const presidentUser = { id: 'u0', name: 'æ©˜ æ¶¼ä»‹ (ç¤¾é•·)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' };
                const committeeChannelId = 'c7';

                // --- ã‚­ãƒƒã‚¯ã‚ªãƒ•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ ---
                setTimeout(() => addTypingIndicator(committeeChannelId, presidentUser), 5000);
                setTimeout(() => {
                    removeTypingIndicator(committeeChannelId, presidentUser.id);
                    sendPresidentKickoffMessage();
                }, 10000);

                // --- URLãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ ---
                setTimeout(() => addTypingIndicator(committeeChannelId, presidentUser), 17000);
                setTimeout(() => {
                    removeTypingIndicator(committeeChannelId, presidentUser.id);
                    sendPresidentURLMessage();
                }, 22000);

            } else {
                nameInput.focus();
                nameInput.classList.add('ring-red-500');
                setTimeout(() => nameInput.classList.remove('ring-red-500'), 2000);
            }
        });

        channelList.addEventListener('click', (e) => {
            const link = e.target.closest('.channel-link');
            if (link) {
                e.preventDefault();
                const newChannelId = link.dataset.channelId;
                const channel = mockData.channels.find(c => c.id === newChannelId);
                
                if (channel && channel.hasNotification) {
                    channel.hasNotification = false;
                }

                if (newChannelId !== currentChannelId) {
                    currentChannelId = newChannelId;
                    renderSidebar();
                    renderMainContent();
                } else {
                    renderSidebar();
                }
                // Close sidebar on mobile after channel selection
                if (window.innerWidth < 640) {
                    sidebar.classList.add('-translate-x-full');
                    sidebarOverlay.classList.add('hidden');
                }
            }
        });

        mainHeader.addEventListener('click', (e) => {
            const toggle = e.target.closest('#sidebar-toggle');
            if (toggle) {
                sidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.remove('hidden');
            }
        });

        sidebarOverlay.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
            sidebarOverlay.classList.add('hidden');
        });
        
        messageInputField.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSendMessage();
            }
        });
        
        document.getElementById('send-button').addEventListener('click', handleSendMessage);

    </script>
</body>
</html>
