<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slack Clone for 採用X</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
        }
        /* Slackのカラーテーマに合わせたカスタムクラス */
        .slack-sidebar { background-color: #1A1D21; }
        .slack-sidebar-text { color: #D1D2D3; }
        .slack-sidebar-text-hover:hover { background-color: #272A2E; }
        .slack-sidebar-active { background-color: #1164A3; color: white; }
        .slack-main { background-color: #1F1F1F; }
        .slack-main-header { border-bottom: 1px solid #2D2E30; }
        .slack-message-input { background-color: #2A2D31; border: 1px solid #4A4C4E; }
        .slack-date-divider-line { border-top: 1px solid #3A3C3D; }
        .slack-date-divider-text { background-color: #1F1F1F; color: #D1D2D3; }

        /* スクロールバーのスタイル */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1F1F1F;
        }
        ::-webkit-scrollbar-thumb {
            background: #4A4C4E;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #5A5C5E;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <!-- Login Screen -->
    <div id="login-screen" class="flex items-center justify-center h-screen">
        <div class="w-full max-w-md p-8 space-y-8 bg-gray-800 rounded-lg shadow-lg text-center">
            <div>
                <svg class="mx-auto h-12 w-auto text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
                <h1 class="mt-6 text-3xl font-bold tracking-tight text-white">採用Xプロジェクトに参加する</h1>
                <p class="mt-2 text-gray-400">これはチーム全体のコミュニケーションを円滑にするためのツールです。</p>
            </div>
            <div class="space-y-6">
                <div>
                    <label for="name-input" class="block text-sm font-medium leading-6 text-gray-300 text-left">チームの代表者の名前を記入する</label>
                    <div class="mt-2">
                        <input id="name-input" name="name" type="text" required class="block w-full rounded-md border-0 bg-white/5 py-2 px-3 text-white shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-blue-500 sm:text-sm sm:leading-6" placeholder="例：山田 太郎">
                    </div>
                </div>
                <button id="join-button" class="w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
                    採用プロジェクトに参加する
                </button>
            </div>
        </div>
    </div>

    <!-- Slack App (Initially Hidden) -->
    <div id="slack-app" class="hidden h-screen antialiased text-gray-200 relative">
        <!-- Sidebar Overlay for Mobile -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden sm:hidden"></div>
        
        <!-- Sidebar -->
        <div id="sidebar" class="slack-sidebar w-72 flex-shrink-0 flex-col overflow-y-auto absolute sm:relative inset-y-0 left-0 z-30 transform -translate-x-full sm:translate-x-0 transition-transform duration-300 ease-in-out">
            <!-- Workspace Header -->
            <div class="flex items-center justify-between h-16 px-4 border-b border-gray-700 flex-shrink-0">
                <h1 class="text-xl font-bold">採用X – ARG</h1>
                <button class="p-2 rounded-md hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.732 3.732z"></path></svg>
                </button>
            </div>

            <!-- Quick Access -->
            <div class="p-4 space-y-2 flex-shrink-0">
                 <div class="relative">
                    <input type="text" placeholder="ジャンプまたは検索..." class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-4 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <svg class="w-5 h-5 absolute top-1/2 right-3 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
            </div>

            <!-- Channels & DMs Scrollable Area -->
            <div class="flex-grow overflow-y-auto">
                <!-- Channels -->
                <div class="px-4 mt-2">
                    <div class="flex items-center mb-2">
                        <h2 class="text-sm font-semibold slack-sidebar-text tracking-wider">チャンネル</h2>
                    </div>
                    <nav id="channel-list" class="space-y-1">
                        <!-- チャンネルはJavaScriptで動的に生成 -->
                    </nav>
                </div>

                <!-- DMs -->
                 <div class="px-4 mt-4">
                    <div class="flex items-center mb-2">
                        <h2 class="text-sm font-semibold slack-sidebar-text tracking-wider">ダイレクトメッセージ</h2>
                    </div>
                    <nav id="dm-list" class="space-y-1">
                         <!-- DMはJavaScriptで動的に生成 -->
                    </nav>
                </div>
            </div>

            <!-- Footer/Profile -->
            <div class="p-4 mt-auto flex-shrink-0">
                <div class="flex items-center">
                    <img src="https://placehold.co/40x40/7E3AF2/FFFFFF?text=YOU" alt="Your Avatar" class="w-8 h-8 rounded-md">
                    <span id="user-profile-name" class="ml-3 text-sm font-medium">あなた</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="main-content" class="flex-1 flex flex-col overflow-hidden slack-main">
            <!-- Header -->
            <header id="main-header" class="flex items-center justify-between h-16 px-6 slack-main-header flex-shrink-0">
                <!-- ヘッダー内容はJSで動的に設定 -->
            </header>

            <!-- Messages -->
            <main id="message-container" class="flex-1 overflow-y-auto p-6">
                <!-- メッセージはJSで動的に生成 -->
            </main>

            <!-- Message Input -->
            <footer class="p-4 flex-shrink-0">
                <div id="message-input-container" class="flex items-center slack-message-input rounded-lg p-2">
                     <button id="add-button" class="p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-full">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                    </button>
                    <input id="message-input-field" type="text" placeholder="#channelへのメッセージ" class="flex-1 bg-transparent px-4 py-2 text-white focus:outline-none">
                    <button id="send-button" class="p-2 text-gray-400 hover:text-white hover:bg-blue-600 rounded-full">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path></svg>
                    </button>
                </div>
                 <div id="typing-indicator-container" class="h-5 text-xs text-gray-400 pl-4 pt-1"></div>
            </footer>
        </div>
    </div>

    <script>
        // --- グローバル変数 ---
        let currentChannelId = 'c0'; // 注意事項チャンネルを最初に表示
        let currentUserName = 'あなた';
        let typingUsers = {}; // { channelId: { userId: 'userName' } }

        // --- 日付取得関数 ---
        function getTodayDateString() {
            const today = new Date();
            return `${today.getFullYear()}年${today.getMonth() + 1}月${today.getDate()}日`;
        }

        // --- データ定義 ---
        const mockData = {
            channels: [
                { id: 'c0', name: '【注意事項】⚠️必ず読んでください', isPublic: true, members: 36, hasNotification: false },
                { id: 'c1', name: '1_全体連絡', isPublic: true, members: 36, hasNotification: false },
                { id: 'c2', name: '2_課題提出', isPublic: true, members: 36, hasNotification: false },
                { id: 'c3', name: '3_雑談', isPublic: true, members: 28, hasNotification: false },
                { id: 'c4', name: '4_面接練習', isPublic: true, members: 15, hasNotification: false },
                { id: 'c5', name: '採用チーム', isPublic: false, members: 5, hasNotification: false },
                { id: 'c6', name: '最終選考', isPublic: false, members: 8, hasNotification: false },
                { id: 'c7', name: '学生採用委員', isPublic: false, members: 6, hasNotification: false },
            ],
            dms: [
                { id: 'd1', name: '橘 涼介 (社長)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' },
                { id: 'd2', name: '人事部長', avatar: 'https://placehold.co/40x40/E94F37/FFFFFF?text=HR' },
                { id: 'd3', name: '橘 陽葵 (メンター)', avatar: 'https://placehold.co/40x40/F4A261/FFFFFF?text=T' },
                { id: 'd4', name: '宮嶋 くん', avatar: 'https://placehold.co/40x40/2A9D8F/FFFFFF?text=M' },
                { id: 'd5', name: '佐藤 花子', avatar: 'https://placehold.co/40x40/F2C53D/FFFFFF?text=S' },
                { id: 'd6', name: '鈴木 一郎', avatar: 'https://placehold.co/40x40/4A7B9D/FFFFFF?text=S' },
            ],
            messages: {
                'c0': [
                    { type: 'date', date: getTodayDateString() },
                    { 
                        type: 'message',
                        user: { id: 'system', name: 'システム', avatar: 'https://placehold.co/40x40/cccccc/000000?text=S' },
                        time: '08:59',
                        text: '<strong>注意事項</strong><br>・このツールは、再読み込みをするとデータが全て消えてしまいます。再読み込みしないようにしてください。'
                    }
                ],
                'c1': [
                    { type: 'date', date: getTodayDateString() },
                    { 
                        type: 'message',
                        user: { id: 'system', name: 'システム', avatar: 'https://placehold.co/40x40/cccccc/000000?text=S' },
                        time: '09:00',
                        text: 'ようこそ「採用X」プロジェクトへ。<br>まずは #【注意事項】⚠️必ず読んでください チャンネルを必ず確認してください。<br>その後、#学生採用委員 チャンネルに社長からのメッセージが届きます。'
                    },
                     { 
                        type: 'message',
                        user: { id: 'player', name: 'あなた', avatar: 'https://placehold.co/40x40/7E3AF2/FFFFFF?text=YOU' },
                        time: '09:01',
                        text: '承知しました。まず注意事項を確認します。'
                    }
                ],
                'c2': [
                    { type: 'date', date: getTodayDateString() },
                    { 
                        type: 'message',
                        user: { id: 'system', name: 'システム', avatar: 'https://placehold.co/40x40/cccccc/000000?text=S' },
                        time: '00:01',
                        text: 'このチャンネルは課題提出専用です。提出物以外の投稿はご遠慮ください。'
                    }
                ],
                'c3': [
                     { type: 'date', date: '2025年8月11日' }, // 過去の会話として日付を固定
                    { 
                        type: 'message',
                        user: { id: 'u2', name: '佐藤 花子', avatar: 'https://placehold.co/40x40/F2C53D/FFFFFF?text=S' },
                        time: '18:30',
                        text: '皆さん、一次選考どうでしたか？私は結構緊張しました…！'
                    },
                    { 
                        type: 'message',
                        user: { id: 'u3', name: '鈴木 一郎', avatar: 'https://placehold.co/40x40/4A7B9D/FFFFFF?text=S' },
                        time: '18:32',
                        text: 'お疲れ様です！わかります、独特の雰囲気ありますよね。次の課題も頑張りましょう！'
                    }
                ],
                'c7': []
            }
        };

        // --- DOM要素 ---
        const loginScreen = document.getElementById('login-screen');
        const slackApp = document.getElementById('slack-app');
        const nameInput = document.getElementById('name-input');
        const joinButton = document.getElementById('join-button');
        const userProfileName = document.getElementById('user-profile-name');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const channelList = document.getElementById('channel-list');
        const dmList = document.getElementById('dm-list');
        const mainHeader = document.getElementById('main-header');
        const messageContainer = document.getElementById('message-container');
        const messageInputField = document.getElementById('message-input-field');
        const typingIndicatorContainer = document.getElementById('typing-indicator-container');

        // --- レンダリング関数 ---

        function renderSidebar() {
            channelList.innerHTML = mockData.channels.map(channel => `
                <a href="#" data-channel-id="${channel.id}" class="channel-link flex items-center px-2 py-1.5 rounded-md text-sm font-medium slack-sidebar-text slack-sidebar-text-hover ${channel.id === currentChannelId ? 'slack-sidebar-active' : ''}">
                    ${channel.isPublic 
                        ? '<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path></svg>' 
                        : '<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>'
                    }
                    <span class="${channel.hasNotification ? 'font-bold text-white' : ''}">${channel.name}</span>
                    ${channel.hasNotification ? '<span class="ml-auto w-2 h-2 bg-red-500 rounded-full"></span>' : ''}
                </a>
            `).join('');

            dmList.innerHTML = mockData.dms.map(dm => `
                <a href="#" class="flex items-center px-2 py-1.5 rounded-md text-sm font-medium slack-sidebar-text slack-sidebar-text-hover">
                    <img src="${dm.avatar}" alt="${dm.name}" class="w-5 h-5 rounded-sm mr-2">
                    <span>${dm.name}</span>
                </a>
            `).join('');
            
            userProfileName.textContent = currentUserName;
        }

        function renderMainContent() {
            const channel = mockData.channels.find(c => c.id === currentChannelId);
            if (!channel) return;

            mainHeader.innerHTML = `
                <div class="flex items-center">
                    <button id="sidebar-toggle" class="sm:hidden mr-4 p-2 rounded-md hover:bg-gray-700">
                         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                    <h2 class="text-xl font-bold">${channel.isPublic ? '#' : '🔒'} ${channel.name}</h2>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-400">${channel.members}人のメンバー</span>
                    <button class="p-2 rounded-md hover:bg-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                    </button>
                </div>
            `;
            
            messageInputField.placeholder = `#${channel.name} へのメッセージ`;
            
            const messages = (mockData.messages[currentChannelId] && mockData.messages[currentChannelId].length > 0) 
                ? mockData.messages[currentChannelId] 
                : [{ type: 'system', text: 'ようこそ！まだメッセージはありません。' }];

            messageContainer.innerHTML = messages.map(msg => {
                if (msg.type === 'date') {
                    return `
                        <div class="relative flex justify-center my-6">
                            <div class="absolute inset-0 flex items-center" aria-hidden="true">
                                <div class="w-full slack-date-divider-line"></div>
                            </div>
                            <div class="relative flex justify-center">
                                <span class="px-3 text-sm font-medium rounded-full border border-gray-600 slack-date-divider-text">${msg.date}</span>
                            </div>
                        </div>
                    `;
                }
                if (msg.type === 'system') {
                     return `<div class="text-center text-gray-400 text-sm">${msg.text}</div>`;
                }
                
                const displayName = msg.user.id === 'player' ? currentUserName : msg.user.name;

                return `
                    <div class="flex items-start mt-4">
                        <img src="${msg.user.avatar}" alt="${displayName}" class="w-10 h-10 rounded-md mr-4">
                        <div class="flex-1">
                            <div class="flex items-baseline">
                                <span class="font-bold mr-2">${displayName}</span>
                                <span class="text-xs text-gray-500">${msg.time}</span>
                            </div>
                            <p class="text-gray-200 mt-1">${msg.text}</p>
                            ${msg.attachments ? `
                                <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2">
                                    ${msg.attachments.map(att => `
                                        <img src="${att.url}" onerror="this.onerror=null;this.src='https://placehold.co/300x200/222/FFF?text=Image+Failed';" alt="添付ファイル" class="rounded-lg border border-gray-700">
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            messageContainer.scrollTop = messageContainer.scrollHeight;
            renderTypingIndicator();
        }

        function renderTypingIndicator() {
            const users = typingUsers[currentChannelId];
            if (users && Object.keys(users).length > 0) {
                const userNames = Object.values(users);
                let text = '';
                if (userNames.length === 1) {
                    text = `${userNames[0]}さんが入力しています...`;
                } else if (userNames.length === 2) {
                    text = `${userNames.join('さんと')}さんが入力しています...`;
                } else {
                    text = '複数人が入力しています...';
                }
                typingIndicatorContainer.textContent = text;
            } else {
                typingIndicatorContainer.textContent = '';
            }
        }
        
        // --- メッセージ送信ロジック ---

        function addTypingIndicator(channelId, user) {
            if (!typingUsers[channelId]) {
                typingUsers[channelId] = {};
            }
            typingUsers[channelId][user.id] = user.name;
            renderTypingIndicator();
        }

        function removeTypingIndicator(channelId, userId) {
            if (typingUsers[channelId] && typingUsers[channelId][userId]) {
                delete typingUsers[channelId][userId];
                renderTypingIndicator();
            }
        }

        function sendPresidentKickoffMessage() {
            const committeeChannel = mockData.channels.find(c => c.name === '学生採用委員');
            const presidentUser = { id: 'u0', name: '橘 涼介 (社長)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' };
            if (!committeeChannel) return;

            if (mockData.messages[committeeChannel.id].length === 0) {
                 mockData.messages[committeeChannel.id].push({ type: 'date', date: getTodayDateString() });
            }

            const kickoffMessage = {
                type: 'message',
                user: presidentUser,
                time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
                text: `皆さん、参加ありがとうございます。<br>株式会社EXIO DESIGN（エクシオデザイン）代表の橘（たちばな）です。<br><br>今回は、新規事業「AI戦略室（せんりゃくしつ）」の初代UI/UXデザイナー採用にあたり、<br>学生採用委員として、皆さんに協力していただきます。<br><br>これから、宮嶋（みやじま）くんに封筒を配ってもらいます。<br>封筒には、応募者の資料が入っています。<br><br>まずはチームごとに採用基準を話し合ってください。<br>「理想のUI/UXデザイナー像」や、<br>重視するポイント（スキル・成長意欲・独自性・即戦力 など）を明確にしましょう。<br><br>採用基準が決まったら、Slackに投稿してください。<br><br>⚠️ このプロジェクトは極秘案件です。<br>情報は必ず、チーム内だけで共有してください。<br><br>それでは、各チームの代表者を決め、話し合いを始めてください。<br>採用基準はSlackに送ってください。<br><br>皆さんの的確な判断に期待しています。`
            };

            mockData.messages[committeeChannel.id].push(kickoffMessage);

            committeeChannel.hasNotification = true;
            renderSidebar();

            if (currentChannelId === committeeChannel.id) {
                renderMainContent();
            }
        }

        function sendPresidentURLMessage() {
            const committeeChannel = mockData.channels.find(c => c.name === '学生採用委員');
            const presidentUser = { id: 'u0', name: '橘 涼介 (社長)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' };
            if (!committeeChannel) return;

            const urlMessage = {
                type: 'message',
                user: presidentUser,
                time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
                text: '君たちには、特別に我が社の採用管理ツールが閲覧できるようにしました！ <br><a href="https://miyajimaryo10.github.io/Applicant_Tracking_System/" target="_blank" class="text-blue-400 hover:underline">EXIO DESIGN採用管理ツール</a><br>ここから応募者の履歴書とかが見れます<br>一通り確認したら、「確認した」って送って！'
            };

            mockData.messages[committeeChannel.id].push(urlMessage);

            if (currentChannelId !== committeeChannel.id) {
                committeeChannel.hasNotification = true;
            }
            
            renderSidebar();

            if (currentChannelId === committeeChannel.id) {
                renderMainContent();
            }
        }
        
        function sendPresidentFollowUpMessage() {
            const committeeChannel = mockData.channels.find(c => c.name === '学生採用委員');
            const presidentUser = { id: 'u0', name: '橘 涼介 (社長)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' };
            if (!committeeChannel) return;

            const followUpMessage = {
                type: 'message',
                user: presidentUser,
                time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
                text: '確認ありがとう！20分くらいで採用基準決めてほしい！<br>決めたら、ここのチャンネルに以下のフォーマットで送ってほしい<br>「採用基準1.〇〇 2.〇〇」'
            };

            mockData.messages[committeeChannel.id].push(followUpMessage);

            if (currentChannelId !== committeeChannel.id) {
                committeeChannel.hasNotification = true;
            }
            
            renderSidebar();

            if (currentChannelId === committeeChannel.id) {
                renderMainContent();
            }
        }

        function sendPresidentSecretMessageSequence() {
            const committeeChannelId = 'c7';
            const presidentUser = { id: 'u0', name: '橘 涼介 (社長)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' };
            const committeeChannel = mockData.channels.find(c => c.id === committeeChannelId);
            if (!committeeChannel) return;

            const addMessage = (text, isQR = false) => {
                const newMessage = {
                    type: 'message',
                    user: presidentUser,
                    time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
                    text: text
                };
                if (isQR) {
                    newMessage.text += `<br><img src="image/LINE_QR.png" alt="LINE QR Code" class="mt-2 rounded-lg">`;
                }
                mockData.messages[committeeChannelId].push(newMessage);
                if (currentChannelId !== committeeChannelId) {
                    committeeChannel.hasNotification = true;
                }
                renderSidebar();
                if (currentChannelId === committeeChannelId) {
                    renderMainContent();
                }
            };

            const sequence = [
                { typing: 0, message: 5000, text: "今、採用担当者の中に、嘘をついている人がいるという匿名告発があった" },
                { typing: 7000, message: 12000, text: "この話はチーム外には内緒で" },
                { typing: 14000, message: 19000, text: "Slackは第三者が見る可能性がある。LINEでやり取りしよう" },
                { typing: 21000, message: 26000, text: "以下のQRコードをスマホで読み込んで、僕のLINEを追加してほしい。", isQR: true }
            ];

            sequence.forEach(step => {
                setTimeout(() => addTypingIndicator(committeeChannelId, presidentUser), step.typing);
                setTimeout(() => {
                    removeTypingIndicator(committeeChannelId, presidentUser.id);
                    addMessage(step.text, step.isQR);
                }, step.message);
            });
        }
        
        function handleSendMessage() {
            const text = messageInputField.value.trim();
            if (text === '') return;

            const newMessage = {
                type: 'message',
                user: { id: 'player', name: currentUserName, avatar: 'https://placehold.co/40x40/7E3AF2/FFFFFF?text=YOU' },
                time: new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
                text: text.replace(/\n/g, '<br>')
            };
            
            if (!mockData.messages[currentChannelId]) {
                mockData.messages[currentChannelId] = [];
            }
            mockData.messages[currentChannelId].push(newMessage);
            messageInputField.value = '';
            renderMainContent();

            // Check for conditional response
            if (currentChannelId === 'c7' && (text.includes('確認した') || text.includes('確認しました'))) {
                const presidentUser = { id: 'u0', name: '橘 涼介 (社長)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' };
                setTimeout(() => addTypingIndicator('c7', presidentUser), 2000);
                setTimeout(() => {
                    removeTypingIndicator('c7', presidentUser.id);
                    sendPresidentFollowUpMessage();
                    
                    // 10秒後に秘密のメッセージシーケンスを開始 (テスト用)
                    setTimeout(() => {
                        sendPresidentSecretMessageSequence();
                    }, 10000); // 10 seconds = 10,000 ms
                }, 7000);
            }
        }


        // --- イベントリスナー ---

        joinButton.addEventListener('click', () => {
            const enteredName = nameInput.value.trim();
            if (enteredName) {
                currentUserName = enteredName;
                loginScreen.style.display = 'none';
                slackApp.style.display = 'flex';
                renderSidebar();
                renderMainContent();
                
                const presidentUser = { id: 'u0', name: '橘 涼介 (社長)', avatar: 'https://placehold.co/40x40/000000/FFFFFF?text=CEO' };
                const committeeChannelId = 'c7';

                // --- キックオフメッセージのシーケンス ---
                setTimeout(() => addTypingIndicator(committeeChannelId, presidentUser), 5000);
                setTimeout(() => {
                    removeTypingIndicator(committeeChannelId, presidentUser.id);
                    sendPresidentKickoffMessage();
                }, 10000);

                // --- URLメッセージのシーケンス ---
                setTimeout(() => addTypingIndicator(committeeChannelId, presidentUser), 17000);
                setTimeout(() => {
                    removeTypingIndicator(committeeChannelId, presidentUser.id);
                    sendPresidentURLMessage();
                }, 22000);

            } else {
                nameInput.focus();
                nameInput.classList.add('ring-red-500');
                setTimeout(() => nameInput.classList.remove('ring-red-500'), 2000);
            }
        });

        channelList.addEventListener('click', (e) => {
            const link = e.target.closest('.channel-link');
            if (link) {
                e.preventDefault();
                const newChannelId = link.dataset.channelId;
                const channel = mockData.channels.find(c => c.id === newChannelId);
                
                if (channel && channel.hasNotification) {
                    channel.hasNotification = false;
                }

                if (newChannelId !== currentChannelId) {
                    currentChannelId = newChannelId;
                    renderSidebar();
                    renderMainContent();
                } else {
                    renderSidebar();
                }
                // Close sidebar on mobile after channel selection
                if (window.innerWidth < 640) {
                    sidebar.classList.add('-translate-x-full');
                    sidebarOverlay.classList.add('hidden');
                }
            }
        });

        mainHeader.addEventListener('click', (e) => {
            const toggle = e.target.closest('#sidebar-toggle');
            if (toggle) {
                sidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.remove('hidden');
            }
        });

        sidebarOverlay.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
            sidebarOverlay.classList.add('hidden');
        });
        
        messageInputField.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSendMessage();
            }
        });
        
        document.getElementById('send-button').addEventListener('click', handleSendMessage);

    </script>
</body>
</html>
